<!DOCTYPE html>
<html>
<head>
    <title>GPS Trajectory Analysis</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #map { height: 100vh; width: 100%; }
        .legend {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 1000;
        }
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
        }
        .stats {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 1000;
            font-size: 12px;
        }
        .stats h3 { margin: 0 0 10px 0; font-size: 14px; }
        .stats-item { margin: 3px 0; }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="legend">
        <h3 style="margin: 0 0 10px 0;">Legend</h3>
        <div class="legend-item">
            <div class="legend-color" style="background: blue;"></div>
            <span>Clean Route</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: red;"></div>
            <span>Jitters (Noise)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: orange;"></div>
            <span>Idling Points</span>
        </div>
    </div>
    
    <div class="stats">
        <h3>Statistics</h3>
        <div class="stats-item">Total Points: 150</div>
        <div class="stats-item">Clean Points: 148</div>
        <div class="stats-item">Jitters Removed: 0</div>
        <div class="stats-item">Idling Events: 4</div>
        <div class="stats-item">Duplicate Timestamps: 2</div>
    </div>
    
    <script>
        // Initialize map
        var map = L.map('map').setView([19.6587516666667, 73.1487366666667], 13);
        
        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);

        // Blue Line: Clean Path
        var cleanLine = [[19.6587516666667,73.1487366666667],[19.6592766666667,73.1493433333333],[19.6613583333333,73.1518583333333],[19.6631083333333,73.16687],[19.706217,72.902158],[19.706217,72.902158],[19.7062166,72.902158],[19.665814,73.159924],[19.665814,73.159924],[19.6530657,73.1496241],[19.660102,73.1526208],[19.653066,73.149624],[19.660102,73.152621],[19.652003,73.133986],[19.6526516666667,73.1388333333333],[19.652655,73.1387583333333],[19.6528916666667,73.13563],[19.6533066666667,73.1300533333333],[19.6541633333333,73.1231883333333],[19.6548016666667,73.11955],[19.6552233333333,73.1186633333333],[19.65563,73.1179883333333],[19.6569366666667,73.11608],[19.65996,73.1113233333333],[19.6599666666667,73.111255],[19.6602983333333,73.1086266666667],[19.6605083333333,73.1076283333333],[19.6617816666667,73.1045733333333],[19.6641066666667,73.0985116666667],[19.6653566666667,73.0956616666667],[19.6662833333333,73.0916683333333],[19.66661,73.0891216666667],[19.6666416666667,73.0873716666667],[19.6669233333333,73.0853783333333],[19.6670683333333,73.0849416666667],[19.668155,73.0821566666667],[19.6687216666667,73.0802683333333],[19.6689716666667,73.078285],[19.66933,73.0757133333333],[19.6696266666667,73.0728583333333],[19.6701733333333,73.0681433333333],[19.67022,73.0676516666667],[19.67014,73.0671816666667],[19.670145,73.0671616666667],[19.6701483333333,73.0671633333333],[19.6701433333333,73.0671616666667],[19.6701433333333,73.0671616666667],[19.6701433333333,73.0671616666667],[19.6701433333333,73.0671616666667],[19.67018,73.0671716666667],[19.6702033333333,73.0671583333333],[19.6782702,73.0731197],[19.6615654,73.0842156],[19.67827,73.07312],[19.67827,73.07312],[19.67827,73.07312],[19.67827,73.07312],[19.67827,73.07312],[19.661565,73.084216],[19.685104,73.016928],[19.67823,73.018975],[19.67825,73.0188966666667],[19.6792366666667,73.016595],[19.6794066666667,73.0154966666667],[19.6793433333333,73.0153483333333],[19.6786633333333,73.0144766666667],[19.6786033333333,73.014395],[19.678415,73.0135566666667],[19.678395,73.0103533333333],[19.67846,73.009845],[19.6785433333333,73.0072216666667],[19.6786833333333,73.0061066666667],[19.6792933333333,73.00306],[19.6815766666667,73.0003116666667],[19.6824566666667,72.9998233333333],[19.68386,72.99927],[19.685515,72.9986316666667],[19.6859416666667,72.9982766666667],[19.6864083333333,72.9978716666667],[19.6870116666667,72.9976483333333],[19.687575,72.9975216666667],[19.6895466666667,72.996315],[19.6904766666667,72.99559],[19.6905816666667,72.99551],[19.691415,72.994725],[19.6914333333333,72.99469],[19.6926816666667,72.992425],[19.6940266666667,72.990435],[19.6953666666667,72.98861],[19.69554,72.988525],[19.6962666666667,72.98798],[19.696285,72.9879166666667],[19.6963416666667,72.9877866666667],[19.6964483333333,72.9872483333333],[19.6963383333333,72.98626],[19.6966266666667,72.98566],[19.697315,72.9846366666667],[19.6980366666667,72.9836916666667],[19.6980633333333,72.9835516666667],[19.698105,72.9834766666667],[19.70598,72.9692283333333],[19.70629,72.9677983333333],[19.7070433333333,72.965805],[19.707585,72.9642616666667],[19.7080116666667,72.9623316666667],[19.709945,72.959375],[19.7127383333333,72.9545016666667],[19.7129466666667,72.9542133333333],[19.71543,72.9514133333333],[19.719345,72.9477916666667],[19.7193983333333,72.94757],[19.71946,72.94627],[19.7192016666667,72.94062],[19.7193033333333,72.9400783333333],[19.7196466666667,72.9364816666667],[19.7196116666667,72.936005],[19.7197216666667,72.93537],[19.7197016666667,72.93461],[19.7196516666667,72.934585],[19.719335,72.9347316666667],[19.7192316666667,72.9348433333333],[19.7191533333333,72.9348866666667],[19.7180516666667,72.9354466666667],[19.7174316666667,72.935535],[19.7161483333333,72.9353183333333],[19.7150566666667,72.93459],[19.7131216666667,72.931955],[19.711835,72.9302916666667],[19.7114416666667,72.9297583333333],[19.711235,72.92952],[19.70907,72.9266583333333],[19.7068166666667,72.9180533333333],[19.7067633333333,72.9176383333333],[19.705845,72.9119733333333],[19.7043766666667,72.9103833333333],[19.7031283333333,72.909935],[19.69654,72.909615],[19.6953616666667,72.9097383333333],[19.6919933333333,72.910905],[19.69035,72.9103766666667],[19.6884966666667,72.9095916666667],[19.6869316666667,72.9092616666667],[19.6794,72.9078383333333],[19.679295,72.90777],[19.6769516666667,72.9062833333333],[19.6752283333333,72.9060816666667],[19.6731016666667,72.906075],[19.6650283333333,72.9063033333333]];
        if (cleanLine.length > 0) {
            var polyline = L.polyline(cleanLine, {
                color: 'blue', 
                weight: 4,
                opacity: 0.7
            }).addTo(map);
            polyline.bindPopup("<b>Clean Route</b><br>148 valid GPS points");
        }

        // Red Dots: Jitters
        var jitters = [];
        jitters.forEach(function(j, index) {
            L.circleMarker(j, {
                color: 'red',
                fillColor: '#ff0000',
                fillOpacity: 0.7,
                radius: 6,
                weight: 2
            }).addTo(map).bindPopup("<b>Jitter (Noise)</b><br>Point #" + (index + 1) + "<br>Removed due to unrealistic speed");
        });

        // Orange Markers: Idling Points
        var idling = [{"lat":19.706217,"lon":72.902158,"duration":1215,"startTime":"2025-11-13T05:21:01.000Z","endTime":"2025-11-13T05:41:16.000Z"},{"lat":19.665814,"lon":73.159924,"duration":147,"startTime":"2025-11-13T05:46:20.000Z","endTime":"2025-11-13T05:48:47.000Z"},{"lat":19.67014,"lon":73.0671816666667,"duration":527,"startTime":"2025-11-13T06:24:55.000Z","endTime":"2025-11-13T06:33:42.000Z"},{"lat":19.67827,"lon":73.07312,"duration":2396,"startTime":"2025-11-13T06:57:28.000Z","endTime":"2025-11-13T07:37:24.000Z"}];
        
        idling.forEach(function(i) {
            var durationMin = Math.round(i.duration / 60);
            var startTime = new Date(i.startTime).toLocaleTimeString();
            var endTime = new Date(i.endTime).toLocaleTimeString();
            
            L.marker([i.lat, i.lon], {
                icon: L.icon({
                    iconUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iNDEiIHZpZXdCb3g9IjAgMCAyNSA0MSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIuNSAwQzUuNiAwIDAgNS42IDAgMTIuNWMwIDguOCAxMi41IDI4LjUgMTIuNSAyOC41UzI1IDIxLjMgMjUgMTIuNUMyNSA1LjYgMTkuNCAMCAxMi41IDB6IiBmaWxsPSIjRkY4QzAwIi8+PGNpcmNsZSBjeD0iMTIuNSIgY3k9IjEyLjUiIHI9IjcuNSIgZmlsbD0iI0ZGRiIvPjwvc3ZnPg==',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34]
                })
            }).addTo(map).bindPopup(
                "<b>Idling Point</b><br>" +
                "Duration: " + durationMin + " minutes<br>" +
                "Start: " + startTime + "<br>" +
                "End: " + endTime
            );
        });

        // Fit map to bounds if we have data
        map.fitBounds([[19.652003,72.902158],[19.7197216666667,73.16687]], { padding: [50, 50] });

        // Add start and end markers
        if (cleanLine.length > 0) {
            L.marker(cleanLine[0], {
                icon: L.icon({
                    iconUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iNDEiIHZpZXdCb3g9IjAgMCAyNSA0MSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIuNSAwQzUuNiAwIDAgNS42IDAgMTIuNWMwIDguOCAxMi41IDI4LjUgMTIuNSAyOC41UzI1IDIxLjMgMjUgMTIuNUMyNSA1LjYgMTkuNCAMCAxMi41IDB6IiBmaWxsPSIjMDBDODUxIi8+PGNpcmNsZSBjeD0iMTIuNSIgY3k9IjEyLjUiIHI9IjcuNSIgZmlsbD0iI0ZGRiIvPjwvc3ZnPg==',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41]
                })
            }).addTo(map).bindPopup("<b>Start Point</b>");
            
            L.marker(cleanLine[cleanLine.length - 1], {
                icon: L.icon({
                    iconUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iNDEiIHZpZXdCb3g9IjAgMCAyNSA0MSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIuNSAwQzUuNiAwIDAgNS42IDAgMTIuNWMwIDguOCAxMi41IDI4LjUgMTIuNSAyOC41UzI1IDIxLjMgMjUgMTIuNUMyNSA1LjYgMTkuNCAMCAxMi41IDB6IiBmaWxsPSIjREM0MzRDIi8+PGNpcmNsZSBjeD0iMTIuNSIgY3k9IjEyLjUiIHI9IjcuNSIgZmlsbD0iI0ZGRiIvPjwvc3ZnPg==',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41]
                })
            }).addTo(map).bindPopup("<b>End Point</b>");
        }
    </script>
</body>
</html>